<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜çº§æ—¥å¿—åˆ†æå·¥å…· - å¤šæ–‡ä»¶æœç´¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#0e42c7',
                        neutral: '#86909C',
                        dark: '#1d2129',
                        success: '#36D399',
                        warning: '#FBBD23',
                        error: '#F87272',
                        info: '#3ABFF8'
                    },
                    fontFamily: {
                        mono: ['Consolas', 'Monaco', 'monospace'],
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            
            .log-container {
                height: calc(100vh - 185px);
                overflow-y: auto;
            }
            
            .file-tree-container {
                height: calc(100vh - 185px);
                overflow-y: auto;
                overflow-x: hidden;
            }
            
            .horizontal-scrollbar {
                position: sticky;
                bottom: 0;
                z-index: 10;
                background-color: white;
                border-top: 1px solid #eee;
                }
                
            .sync-scroll {
                scrollbar-width: thin;
            }
            
            /* é«˜äº®é¢œè‰²å®šä¹‰ */
            .highlight-0 {
                @apply bg-yellow-200 text-gray-800;
            }
            
            .highlight-1 {
                @apply bg-blue-200 text-gray-800;
            }
            
            .highlight-2 {
                @apply bg-green-200 text-gray-800;
            }
            
            .highlight-3 {
                @apply bg-pink-200 text-gray-800;
            }
            
            .highlight-4 {
                @apply bg-purple-200 text-gray-800;
            }
            
            .highlight-5 {
                @apply bg-orange-200 text-gray-800;
            }
            
            .highlight-6 {
                @apply bg-cyan-200 text-gray-800;
            }
            
            .highlight-7 {
                @apply bg-red-200 text-gray-800;
            }
            
            .highlight-8 {
                @apply bg-lime-200 text-gray-800;
            }
            
            .highlight-9 {
                @apply bg-amber-200 text-gray-800;
            }
            
            /* æ–‡ä»¶æ ‘æ ·å¼ */
            .file-tree-node {
                @apply py-1 px-2 rounded-md cursor-pointer hover:bg-gray-100 transition-colors;
            }
            
            .file-tree-node-active {
                @apply bg-primary/10 font-medium text-primary;
            }
            
            .file-tree-icon {
                @apply w-5 text-center mr-1.5;
            }
            
            .file-tree-children {
                @apply pl-5 ml-1 border-l border-gray-200;
            }
            
            .toast {
                @apply fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 px-5 py-3 rounded-lg shadow-lg text-sm font-medium transition-all duration-300 transform scale-95 opacity-0 z-50 whitespace-nowrap;
            }
            
            .toast-success {
                @apply bg-green-50 text-green-700 border border-green-200;
            }
            
            .toast-error {
                @apply bg-red-50 text-red-700 border border-red-200;
            }
            
            .toast-warning {
                @apply bg-yellow-50 text-yellow-700 border border-yellow-200;
            }
            
            .toast-info {
                @apply bg-blue-50 text-blue-700 border border-blue-200;
            }
            
            /* æ–°å¢æ ·å¼ */
            .resizer {
                @apply bg-gray-200 w-1 cursor-col-resize hover:bg-gray-300 transition-colors;
            }
            
            .default-log {
                @apply text-gray-600 bg-gray-50 p-4 rounded-lg border border-gray-200;
            }
            
            .log-line {
                @apply block whitespace-pre-wrap break-words;
            }
            
            .hidden-line {
                @apply hidden;
            }
            
            .search-container {
                @apply flex flex-wrap items-start gap-4;
            }
            
            .options-container {
                @apply flex flex-col gap-2;
            }
            
            .search-box {
                @apply flex-1 min-w-[300px] max-w-3xl;
            }
            
            .search-hint {
                @apply text-xs text-gray-500 mt-1;
            }
        }
    </style>
</head>
<body class="bg-gray-50 m-0 p-0 font-sans">
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <header class="bg-gradient-to-r from-primary to-secondary shadow-xs p-3">
        <div class="flex justify-between items-center">
            <div class="flex items-center">
                <i class="fa fa-file-text-o text-white mr-2 text-xl"></i>
                <h1 class="text-xl font-bold text-white inline-block">é«˜çº§æ—¥å¿—åˆ†æå·¥å…·</h1>
                <a href="//172.16.191.214/moduleParser/powerLparser/tools/PowerCenter.html" target="_blank"
                    rel="noopener noreferrer"
                    class="ml-4 bg-yellow-400 hover:bg-yellow-500 text-black font-bold py-1 px-3 rounded-lg shadow-md hover:shadow-lg transition-all duration-200">
                    ğŸ”¥ çŒ›æˆ³è¿™é‡Œè·å¾—æ›´å¤šä¿¡æ¯ ğŸ”¥
                </a>
            </div>
            <div class="flex gap-2">
                <button id="uploadBtn"
                    class="bg-white text-primary px-4 py-2 rounded-lg text-sm flex items-center font-medium hover:bg-gray-50 transition">
                    <i class="fa fa-folder-open-o mr-2"></i>å¯¼å…¥æ–‡ä»¶å¤¹
                </button>
                <button id="copyBtn"
                    class="bg-white text-gray-700 px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-50 transition flex items-center">
                    <i class="fa fa-copy mr-2"></i>å¤åˆ¶
                </button>
                <button id="clearHighlightBtn"
                    class="bg-white text-gray-700 px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-50 transition flex items-center">
                    <i class="fa fa-times mr-2"></i>æ¸…é™¤é«˜äº®
                </button>
            </div>
        </div>
    </header>

    <!-- æœç´¢å’Œå¿«æ·é”®æç¤ºåŒºåŸŸ -->
    <div class="bg-white border-b border-gray-100 p-4">
        <div class="search-container">
            <!-- æœç´¢æ¡†åŒºåŸŸ -->
            <div class="search-box">
                <div class="flex items-center gap-2 mb-1">
                    <i class="fa fa-search text-neutral"></i>
                    <input type="text" id="searchInput"
                        placeholder="æœç´¢æ—¥å¿—å†…å®¹ï¼ˆå…³é”®å­—ç”¨å•å¼•å·åŒ…è£¹ï¼Œç©ºæ ¼åˆ†éš”ï¼Œå¦‚ï¼š'error' 'timeout'ï¼‰..."
                        class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-base">
                    <button id="clearSearch" class="text-neutral hover:text-gray-700 transition hidden">
                        <i class="fa fa-times-circle text-lg"></i>
                    </button>
                </div>
                <div class="search-hint">
                    éæ­£åˆ™æ¨¡å¼ä¸‹ï¼Œè¯·ä½¿ç”¨å•å¼•å·åŒ…è£¹å…³é”®å­—å¹¶ç”¨ç©ºæ ¼åˆ†éš”
                </div>

                <!-- å…³é”®è¯é¢œè‰²å›¾ä¾‹ -->
                <div id="keywordLegend" class="flex flex-wrap gap-2 mt-2 hidden">
                    <span class="text-xs text-gray-600">å…³é”®è¯é¢œè‰²:</span>
                </div>
            </div>

            <!-- é€‰é¡¹åŒºåŸŸ -->
            <div class="options-container">
                <div class="flex gap-4 text-sm bg-gray-50 p-3 rounded-lg border border-gray-200 border-[0.5px]">
                    <label class="flex items-center text-gray-700 cursor-pointer whitespace-nowrap">
                        <input type="checkbox" id="regexCheckbox"
                            class="mr-2 h-4 w-4 text-primary rounded focus:ring-primary">
                        æ­£åˆ™è¡¨è¾¾å¼
                    </label>
                    <label class="flex items-center text-gray-700 cursor-pointer whitespace-nowrap">
                        <input type="checkbox" id="ignoreCaseCheckbox"
                            class="mr-2 h-4 w-4 text-primary rounded focus:ring-primary" checked>
                        å¿½ç•¥å¤§å°å†™
                    </label>
                    <label class="flex items-center text-gray-700 cursor-pointer whitespace-nowrap">
                        <input type="checkbox" id="multiFileSearch"
                            class="mr-2 h-4 w-4 text-primary rounded focus:ring-primary" checked>
                        å¤šæ–‡ä»¶æœç´¢
                    </label>
                    <label class="flex items-center text-gray-700 cursor-pointer whitespace-nowrap">
                        <input type="checkbox" id="showOnlyMatches"
                            class="mr-2 h-4 w-4 text-primary rounded focus:ring-primary" checked>
                        åªæ˜¾ç¤ºåŒ¹é…è¡Œ
                    </label>
                    <div id="searchError"
                        class="flex items-center text-red-500 text-sm hidden ml-2">
                        <i class="fa fa-exclamation-triangle mr-1"></i><span></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="p-4 flex gap-0">
        <!-- å·¦ä¾§æ–‡ä»¶æ ‘ -->
        <div id="fileTreeContainer" class="shrink-0 transition-all duration-200">
            <div class="bg-white border border-gray-200 rounded-lg shadow-sm h-full flex flex-col">
                <div class="p-3 border-b border-gray-100 bg-gray-50 font-medium">
                    <i class="fa fa-folder-open-o mr-1.5"></i>æ–‡ä»¶ç»“æ„
                </div>
                <div id="fileTree" class="file-tree-container p-2">
                    <div class="text-center text-gray-500 py-16">
                        <i class="fa fa-folder-open-o text-4xl mb-3 text-gray-300"></i>
                        <p>è¯·å¯¼å…¥æ–‡ä»¶å¤¹</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- è°ƒæ•´å¤§å°åˆ†éš”çº¿ -->
        <div id="resizer" class="resizer"></div>
        
        <!-- å³ä¾§æ—¥å¿—å†…å®¹ -->
        <div id="logContainer" class="flex-1 pl-4">
            <div class="bg-white border border-gray-200 rounded-lg shadow-sm h-full flex flex-col">
                <div id="currentFileName" class="p-3 border-b border-gray-100 bg-gray-50 font-medium">
                    é»˜è®¤ç¤ºä¾‹æ—¥å¿—
                </div>
                <!-- æ—¥å¿—æ–‡æœ¬åŒºåŸŸ - çºµå‘æ»šåŠ¨ -->
                <div id="logContent" class="log-container font-mono text-sm p-2">
                    <pre class="whitespace-pre-wrap break-words default-log">2025-07-12 08:30:00 [INFO] åº”ç”¨å¯åŠ¨æˆåŠŸ
2025-07-12 08:30:01 [INFO] æ•°æ®åº“è¿æ¥æˆåŠŸ
2025-07-12 08:30:02 [INFO] ç¼“å­˜æœåŠ¡åˆå§‹åŒ–å®Œæˆ
2025-07-12 08:30:03 [INFO] ç”¨æˆ·æœåŠ¡å¯åŠ¨å®Œæˆ
2025-07-12 08:30:05 [INFO] APIæœåŠ¡å¯åŠ¨å®Œæˆï¼Œç›‘å¬ç«¯å£: 8080
2025-07-12 08:35:12 [INFO] ç”¨æˆ· admin ç™»å½•æˆåŠŸ
2025-07-12 08:36:45 [INFO] ç”¨æˆ· admin åˆ›å»ºäº†æ–°è®¢å• #ORD12345
2025-07-12 08:37:20 [INFO] è®¢å• #ORD12345 æ”¯ä»˜æˆåŠŸ
2025-07-12 08:40:15 [WARNING] æ£€æµ‹åˆ°æ•°æ®åº“è¿æ¥è¶…æ—¶ï¼Œæ­£åœ¨é‡è¯•...
2025-07-12 08:40:18 [INFO] æ•°æ®åº“é‡æ–°è¿æ¥æˆåŠŸ
2025-07-12 08:45:30 [INFO] ç”¨æˆ· test_user ç™»å½•æˆåŠŸ
2025-07-12 08:47:12 [INFO] ç”¨æˆ· test_user åˆ›å»ºäº†æ–°è®¢å• #ORD12346
2025-07-12 08:48:35 [ERROR] è®¢å• #ORD12346 æ”¯ä»˜å¤±è´¥: ä½™é¢ä¸è¶³
2025-07-12 08:48:37 [INFO] è®¢å• #ORD12346 çŠ¶æ€æ›´æ–°ä¸ºå·²å–æ¶ˆ
2025-07-12 09:00:00 [INFO] ç³»ç»Ÿå®šæ—¶ä»»åŠ¡å¯åŠ¨
2025-07-12 09:00:15 [INFO] æ•°æ®å¤‡ä»½ä»»åŠ¡å®Œæˆ
2025-07-12 09:15:20 [INFO] ç”¨æˆ· admin ç™»å‡ºç³»ç»Ÿ
2025-07-12 09:20:45 [INFO] ç”¨æˆ· test_user ç™»å‡ºç³»ç»Ÿ
2025-07-12 09:30:00 [INFO] åº”ç”¨æ€§èƒ½ç»Ÿè®¡:
2025-07-12 09:30:00 [INFO]   è¯·æ±‚æ€»æ•°: 128
2025-07-12 09:30:00 [INFO]   å¹³å‡å“åº”æ—¶é—´: 128ms
2025-07-12 09:30:00 [INFO]   æœ€å¤§å“åº”æ—¶é—´: 456ms
2025-07-12 09:30:00 [INFO]   é”™è¯¯è¯·æ±‚æ•°: 3
2025-07-12 09:30:05 [INFO] åº”ç”¨æ­£å¸¸å…³é—­</pre>
                </div>

                <!-- æ¨ªå‘æ»šåŠ¨æ¡ - å›ºå®šåœ¨åº•éƒ¨ï¼Œä¸å†…å®¹åŒæ­¥æ»šåŠ¨ -->
                <div class="horizontal-scrollbar">
                    <div id="syncScroll" class="sync-scroll h-3">
                        <div id="scrollProxy" class="h-3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOMå…ƒç´ 
        const logContentEl = document.getElementById('logContent');
        const syncScrollEl = document.getElementById('syncScroll');
        const scrollProxyEl = document.getElementById('scrollProxy');
        const searchInputEl = document.getElementById('searchInput');
        const clearSearchEl = document.getElementById('clearSearch');
        const clearHighlightBtnEl = document.getElementById('clearHighlightBtn');
        const uploadBtnEl = document.getElementById('uploadBtn');
        const copyBtnEl = document.getElementById('copyBtn');
        const regexCheckbox = document.getElementById('regexCheckbox');
        const ignoreCaseCheckbox = document.getElementById('ignoreCaseCheckbox');
        const multiFileSearchCheckbox = document.getElementById('multiFileSearch');
        const showOnlyMatchesCheckbox = document.getElementById('showOnlyMatches');
        const searchErrorEl = document.getElementById('searchError');
        const keywordLegendEl = document.getElementById('keywordLegend');
        const fileTreeEl = document.getElementById('fileTree');
        const currentFileNameEl = document.getElementById('currentFileName');
        const fileTreeContainer = document.getElementById('fileTreeContainer');
        const logContainer = document.getElementById('logContainer');
        const resizer = document.getElementById('resizer');
        
        // æ»šåŠ¨é…ç½®
        const SCROLL_SPEED = 50;
        const FAST_SCROLL_SPEED = 200;
        
        // é»˜è®¤æ–‡ä»¶æ ‘å®½åº¦ï¼ˆåƒç´ ï¼‰
        const DEFAULT_FILE_TREE_WIDTH = 300;
        
        // å½“å‰æ–‡ä»¶å†…å®¹
        let currentFileContent = `2025-07-12 08:30:00 [INFO] åº”ç”¨å¯åŠ¨æˆåŠŸ
2025-07-12 08:30:01 [INFO] æ•°æ®åº“è¿æ¥æˆåŠŸ
2025-07-12 08:30:02 [INFO] ç¼“å­˜æœåŠ¡åˆå§‹åŒ–å®Œæˆ
2025-07-12 08:30:03 [INFO] ç”¨æˆ·æœåŠ¡å¯åŠ¨å®Œæˆ
2025-07-12 08:30:05 [INFO] APIæœåŠ¡å¯åŠ¨å®Œæˆï¼Œç›‘å¬ç«¯å£: 8080
2025-07-12 08:35:12 [INFO] ç”¨æˆ· admin ç™»å½•æˆåŠŸ
2025-07-12 08:36:45 [INFO] ç”¨æˆ· admin åˆ›å»ºäº†æ–°è®¢å• #ORD12345
2025-07-12 08:37:20 [INFO] è®¢å• #ORD12345 æ”¯ä»˜æˆåŠŸ
2025-07-12 08:40:15 [WARNING] æ£€æµ‹åˆ°æ•°æ®åº“è¿æ¥è¶…æ—¶ï¼Œæ­£åœ¨é‡è¯•...
2025-07-12 08:40:18 [INFO] æ•°æ®åº“é‡æ–°è¿æ¥æˆåŠŸ
2025-07-12 08:45:30 [INFO] ç”¨æˆ· test_user ç™»å½•æˆåŠŸ
2025-07-12 08:47:12 [INFO] ç”¨æˆ· test_user åˆ›å»ºäº†æ–°è®¢å• #ORD12346
2025-07-12 08:48:35 [ERROR] è®¢å• #ORD12346 æ”¯ä»˜å¤±è´¥: ä½™é¢ä¸è¶³
2025-07-12 08:48:37 [INFO] è®¢å• #ORD12346 çŠ¶æ€æ›´æ–°ä¸ºå·²å–æ¶ˆ
2025-07-12 09:00:00 [INFO] ç³»ç»Ÿå®šæ—¶ä»»åŠ¡å¯åŠ¨
2025-07-12 09:00:15 [INFO] æ•°æ®å¤‡ä»½ä»»åŠ¡å®Œæˆ
2025-07-12 09:15:20 [INFO] ç”¨æˆ· admin ç™»å‡ºç³»ç»Ÿ
2025-07-12 09:20:45 [INFO] ç”¨æˆ· test_user ç™»å‡ºç³»ç»Ÿ
2025-07-12 09:30:00 [INFO] åº”ç”¨æ€§èƒ½ç»Ÿè®¡:
2025-07-12 09:30:00 [INFO]   è¯·æ±‚æ€»æ•°: 128
2025-07-12 09:30:00 [INFO]   å¹³å‡å“åº”æ—¶é—´: 128ms
2025-07-12 09:30:00 [INFO]   æœ€å¤§å“åº”æ—¶é—´: 456ms
2025-07-12 09:30:00 [INFO]   é”™è¯¯è¯·æ±‚æ•°: 3
2025-07-12 09:30:05 [INFO] åº”ç”¨æ­£å¸¸å…³é—­`;
        
        // é«˜äº®é¢œè‰²æ± 
        const highlightColors = [
            'highlight-0', // é»„è‰²
            'highlight-1', // è“è‰²
            'highlight-2', // ç»¿è‰²
            'highlight-3', // ç²‰è‰²
            'highlight-4', // ç´«è‰²
            'highlight-5', // æ©™è‰²
            'highlight-6', // é’è‰²
            'highlight-7', // çº¢è‰²
            'highlight-8', // é’æŸ è‰²
            'highlight-9'  // ç¥ç€è‰²
        ];
        
        // å…³é”®è¯åˆ°é¢œè‰²çš„æ˜ å°„
        let keywordColorMap = {};
        
        // æ–‡ä»¶å¤¹ç»“æ„
        let folderStructure = {
            name: 'root',
            isDirectory: true,
            children: [],
            content: null
        };
        
        // å½“å‰é€‰ä¸­çš„æ–‡ä»¶è·¯å¾„
        let selectedFilePath = null;
        
        // æœç´¢ç»“æœ
        let searchResults = {};
        
        // åˆå§‹åŒ–
        function init() {
            setupScrollSync();
            setupEventListeners();
            setupKeyboardNavigation();
            setupResizer();
            initEventListeners();
            
            // è®¾ç½®é»˜è®¤æ–‡ä»¶æ ‘å®½åº¦
            fileTreeContainer.style.width = `${DEFAULT_FILE_TREE_WIDTH}px`;
            
            // æ›´æ–°æ»šåŠ¨ä»£ç†å®½åº¦ä»¥åŒ¹é…å†…å®¹å®½åº¦
            scrollProxyEl.style.width = `${logContentEl.scrollWidth}px`;
        }
        
        // åŠ è½½é»˜è®¤æ—¥å¿—ç¤ºä¾‹
        function loadDefaultLog() {
            // å·²åœ¨HTMLä¸­ç›´æ¥æ˜¾ç¤ºé»˜è®¤æ—¥å¿—
        }
        
        // å…¨å±åˆ‡æ¢å‡½æ•°
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                // è¿›å…¥å…¨å±
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen();
                } else if (document.documentElement.webkitRequestFullscreen) {
                    document.documentElement.webkitRequestFullscreen();
                } else if (document.documentElement.msRequestFullscreen) {
                    document.documentElement.msRequestFullscreen();
                }
                showToast('é€€å‡ºå…¨å±ç»§ç»­æŒ‰Alt+x');
            } else {
                // é€€å‡ºå…¨å±
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.documentElement.msExitFullscreen) {
                    document.documentElement.msExitFullscreen();
                }
            }
        }
        
        // å¤„ç†å…¨å±å˜åŒ–
        function handleFullscreenChange() {
            if (document.fullscreenElement) {
                // å…¨å±ä¿¡æ¯æ˜¾ç¤º
            } else {
                // éå…¨å±ä¿¡æ¯æ˜¾ç¤º
            }
        }
        
        // è®¾ç½®å¿«æ·é”®ç›‘å¬
        function setupShortcutListener() {
            document.addEventListener('keydown', (e) => {
                // æ£€æµ‹ Alt + X
                if (e.altKey && (e.key === 'x' || e.key === 'X')) {
                    toggleFullscreen();
                    e.preventDefault();
                }
            });
        }
        
        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
        function initEventListeners() {
            // å…¨å±äº‹ä»¶ç›‘å¬
            document.addEventListener('fullscreenchange', handleFullscreenChange);
            document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
            document.addEventListener('msfullscreenchange', handleFullscreenChange);
            
            // è®¾ç½®å¿«æ·é”®
            setupShortcutListener();
        }
        
        // è®¾ç½®æ»šåŠ¨åŒæ­¥ - æ¨ªå‘æ»šåŠ¨æ¡ä¸å†…å®¹åŒæ­¥
        function setupScrollSync() {
            // å½“å†…å®¹æ¨ªå‘æ»šåŠ¨æ—¶ï¼ŒåŒæ­¥æ»šåŠ¨æ¡ä½ç½®
            logContentEl.addEventListener('scroll', (e) => {
                syncScrollEl.scrollLeft = e.target.scrollLeft;
            });
            
            // å½“æ»šåŠ¨æ¡æ»šåŠ¨æ—¶ï¼ŒåŒæ­¥å†…å®¹ä½ç½®
            syncScrollEl.addEventListener('scroll', (e) => {
                logContentEl.scrollLeft = e.target.scrollLeft;
            });
        }
        
        // è®¾ç½®é”®ç›˜å¯¼èˆª - å·¦å³æ–¹å‘é”®æ§åˆ¶æ¨ªå‘æ»šåŠ¨
        function setupKeyboardNavigation() {
            document.addEventListener('keydown', (e) => {
                // å¦‚æœæœç´¢æ¡†èšç„¦ï¼Œåˆ™ä¸å¤„ç†æ»šåŠ¨ï¼ˆé¿å…å½±å“è¾“å…¥ï¼‰
                if (document.activeElement === searchInputEl) {
                    // æ”¯æŒEscæ¸…é™¤æœç´¢
                    if (e.key === 'Escape') {
                        clearSearch();
                    }
                    return;
                }
                
                // Fé”®èšç„¦æœç´¢æ¡†
                if (e.key === 'f' || e.key === 'F') {
                    // æ£€æŸ¥æ˜¯å¦æŒ‰ä¸‹äº†Ctrlé”®
                    if (e.ctrlKey || e.metaKey) {
                        // å¦‚æœæ˜¯Ctrl+Fï¼Œåˆ™å…è®¸æµè§ˆå™¨é»˜è®¤è¡Œä¸º
                        return;
                    }
                    e.preventDefault();
                    searchInputEl.focus();
                    searchInputEl.select();
                    showToast('å·²èšç„¦æœç´¢æ¡† - æŒ‰Enteræœç´¢');
                    return;
                }
                
                // æ”¯æŒEscæ¸…é™¤æœç´¢
                if (e.key === 'Escape') {
                    clearSearch();
                    return;
                }
                
                const isShiftPressed = e.shiftKey;
                const scrollAmount = isShiftPressed ? FAST_SCROLL_SPEED : SCROLL_SPEED;
                
                // å·¦æ–¹å‘é”® - å‘å·¦æ»šåŠ¨
                if (e.key === 'ArrowLeft') {
                    e.preventDefault(); // é˜»æ­¢é¡µé¢é»˜è®¤æ»šåŠ¨è¡Œä¸º
                    const newScrollLeft = logContentEl.scrollLeft - scrollAmount;
                    logContentEl.scrollLeft = Math.max(0, newScrollLeft);
                }
                
                // å³æ–¹å‘é”® - å‘å³æ»šåŠ¨
                if (e.key === 'ArrowRight') {
                    e.preventDefault(); // é˜»æ­¢é¡µé¢é»˜è®¤æ»šåŠ¨è¡Œä¸º
                    const maxScroll = logContentEl.scrollWidth - logContentEl.clientWidth;
                    const newScrollLeft = logContentEl.scrollLeft + scrollAmount;
                    logContentEl.scrollLeft = Math.min(maxScroll, newScrollLeft);
                }
            });
        }
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬
        function setupEventListeners() {
            // æ·»åŠ  Enter é”®äº‹ä»¶ç›‘å¬
            searchInputEl.addEventListener('keydown', function (e) {
                if (e.key === 'Enter' || e.keyCode === 13) {
                    handleSearch(); // ä»…åœ¨æŒ‰ä¸‹ Enter æ—¶è§¦å‘æœç´¢
                }
            });
            
            clearSearchEl.addEventListener('click', clearSearch);
            clearHighlightBtnEl.addEventListener('click', clearHighlight);
            
            // æ­£åˆ™å’Œå¿½ç•¥å¤§å°å†™è®¾ç½®æ”¹å˜æ—¶é‡æ–°æœç´¢
            regexCheckbox.addEventListener('change', handleSearch);
            ignoreCaseCheckbox.addEventListener('change', handleSearch);
            multiFileSearchCheckbox.addEventListener('change', handleSearch);
            showOnlyMatchesCheckbox.addEventListener('change', handleSearch);
            
            // ä¸Šä¼ æ—¥å¿—
            uploadBtnEl.addEventListener('click', () => {
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.webkitdirectory = true;
                fileInput.directory = true;
                fileInput.multiple = true;
                
                fileInput.onchange = handleFolderUpload;
                fileInput.click();
            });
            
            // å¤åˆ¶æ—¥å¿—
            copyBtnEl.addEventListener('click', copyLogs);
        }
        
        // å¤„ç†æ–‡ä»¶å¤¹ä¸Šä¼ 
        function handleFolderUpload(e) {
            const files = e.target.files;
            if (!files.length) return;
            
            showToast('æ­£åœ¨å¤„ç†æ–‡ä»¶...');
            
            // é‡ç½®æ–‡ä»¶å¤¹ç»“æ„
            folderStructure = {
                name: 'root',
                isDirectory: true,
                children: [],
                content: null
            };
            
            // è§£ææ–‡ä»¶ç»“æ„
            const directoryMap = new Map();
            directoryMap.set('', folderStructure);
            
            // å¼‚æ­¥å¤„ç†æ–‡ä»¶
            const processFiles = async () => {
                // æ„å»ºæ–‡ä»¶å¤¹ç»“æ„
                for (const file of files) {
                    const relativePath = file.webkitRelativePath;
                    const pathParts = relativePath.split('/');
                    const fileName = pathParts.pop();
                    const directoryPath = pathParts.join('/');
                    
                    // ç¡®ä¿ç›®å½•å­˜åœ¨
                    if (!directoryMap.has(directoryPath)) {
                        await createDirectoryPath(directoryPath, directoryMap);
                    }
                    
                    // è·å–çˆ¶ç›®å½•
                    const parentDir = directoryMap.get(directoryPath);
                    
                    // æ·»åŠ æ–‡ä»¶
                    const fileNode = {
                        name: fileName,
                        isDirectory: false,
                        path: relativePath,
                        content: null,
                        file: file,
                        hasMatches: false // æ·»åŠ åŒ¹é…çŠ¶æ€
                    };
                    
                    parentDir.children.push(fileNode);
                }
                
                // æ¸²æŸ“æ–‡ä»¶æ ‘
                renderFileTree(folderStructure);
                
                // æ˜¾ç¤ºæˆåŠŸæç¤º
                showToast(`æˆåŠŸå¯¼å…¥ ${files.length} ä¸ªæ–‡ä»¶`);
                
                // å¦‚æœæœ‰æ–‡ä»¶ï¼Œé»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ª
                if (files.length > 0) {
                    // æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ–‡ä»¶èŠ‚ç‚¹
                    const firstFile = findFirstFile(folderStructure);
                    if (firstFile) {
                        selectFile(firstFile);
                    }
                }
                
                // é‡ç½®æœç´¢
                clearSearch();
            };
            
            processFiles();
        }
        
        // æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ–‡ä»¶èŠ‚ç‚¹
        function findFirstFile(node) {
            if (!node.isDirectory && node.file) {
                return node;
            }
            
            if (node.children && node.children.length > 0) {
                for (const child of node.children) {
                    const file = findFirstFile(child);
                    if (file) return file;
                }
            }
            
            return null;
        }
        
        // åˆ›å»ºç›®å½•è·¯å¾„
        async function createDirectoryPath(path, directoryMap) {
            const pathParts = path.split('/');
            let currentPath = '';
            
            for (let i = 0; i < pathParts.length; i++) {
                const part = pathParts[i];
                currentPath = currentPath ? `${currentPath}/${part}` : part;
                
                if (!directoryMap.has(currentPath)) {
                    // æ‰¾åˆ°çˆ¶ç›®å½•
                    const parentPath = pathParts.slice(0, i).join('/');
                    const parentDir = directoryMap.get(parentPath) || folderStructure;
                    
                    // åˆ›å»ºæ–°ç›®å½•
                    const newDir = {
                        name: part,
                        isDirectory: true,
                        path: currentPath,
                        children: [],
                        content: null
                    };
                    
                    // æ·»åŠ åˆ°çˆ¶ç›®å½•
                    parentDir.children.push(newDir);
                    
                    // æ·»åŠ åˆ°ç›®å½•æ˜ å°„
                    directoryMap.set(currentPath, newDir);
                }
            }
        }
        
        // æ¸²æŸ“æ–‡ä»¶æ ‘
        function renderFileTree(node, parentElement = null) {
            const container = parentElement || fileTreeEl;
            
            // æ¸…ç©ºå®¹å™¨
            if (!parentElement) {
                container.innerHTML = '';
            }
            
            // åˆ›å»ºèŠ‚ç‚¹å…ƒç´ 
            const nodeElement = document.createElement('div');
            nodeElement.className = 'file-tree-node';
            nodeElement.dataset.path = node.path || '';
            
            // æ·»åŠ å›¾æ ‡å’Œåç§°
            if (node.isDirectory) {
                nodeElement.innerHTML = `
                    <div class="flex items-center cursor-pointer" data-path="${node.path || ''}">
                        <i class="file-tree-icon fa fa-folder-o text-warning"></i>
                        <span>${node.name}</span>
                        <i class="ml-auto fa fa-chevron-down text-xs transition-transform duration-200 ${node.collapsed ? 'rotate-0' : 'rotate-90'}"></i>
                    </div>
                `;
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                const toggleElement = nodeElement.querySelector('.flex');
                toggleElement.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleDirectory(node, nodeElement);
                });
                
                // æ·»åŠ åŒå‡»äº‹ä»¶ï¼ˆç”¨äºå¯¼èˆªï¼‰
                toggleElement.addEventListener('dblclick', (e) => {
                    e.stopPropagation();
                    if (node.children && node.children.length > 0) {
                        node.collapsed = !node.collapsed;
                        renderFileTree(node, parentElement);
                    }
                });
                
                // æ·»åŠ å­èŠ‚ç‚¹
                if (node.children && node.children.length > 0 && !node.collapsed) {
                    const childrenContainer = document.createElement('div');
                    childrenContainer.className = 'file-tree-children';
                    
                    node.children.forEach(child => {
                        renderFileTree(child, childrenContainer);
                    });
                    
                    nodeElement.appendChild(childrenContainer);
                }
            } else {
                // æ–‡ä»¶èŠ‚ç‚¹
                nodeElement.innerHTML = `
                    <div class="flex items-center" data-path="${node.path}">
                        <i class="file-tree-icon fa fa-file-text-o text-neutral"></i>
                        <span>${node.name}</span>
                        ${node.hasMatches ? '<span class="ml-2 text-xs text-primary bg-primary/10 px-1 rounded search-match-indicator">æœ‰åŒ¹é…</span>' : ''}
                    </div>
                `;
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                nodeElement.addEventListener('click', () => {
                    selectFile(node);
                });
            }
            
            // æ·»åŠ åˆ°å®¹å™¨
            container.appendChild(nodeElement);
        }
        
        // åˆ‡æ¢ç›®å½•å±•å¼€/æŠ˜å çŠ¶æ€
        function toggleDirectory(node, element) {
            node.collapsed = !node.collapsed;
            
            // æ‰¾åˆ°å­èŠ‚ç‚¹å®¹å™¨
            const childrenContainer = element.querySelector('.file-tree-children');
            
            if (node.collapsed) {
                // æŠ˜å ç›®å½•
                if (childrenContainer) {
                    childrenContainer.remove();
                }
                element.querySelector('.fa-chevron-down').classList.remove('rotate-90');
                element.querySelector('.fa-chevron-down').classList.add('rotate-0');
            } else {
                // å±•å¼€ç›®å½•
                if (!childrenContainer && node.children && node.children.length > 0) {
                    const newChildrenContainer = document.createElement('div');
                    newChildrenContainer.className = 'file-tree-children';
                    
                    node.children.forEach(child => {
                        renderFileTree(child, newChildrenContainer);
                    });
                    
                    element.appendChild(newChildrenContainer);
                }
                element.querySelector('.fa-chevron-down').classList.remove('rotate-0');
                element.querySelector('.fa-chevron-down').classList.add('rotate-90');
            }
        }
        
        // é€‰æ‹©æ–‡ä»¶
        function selectFile(node) {
            // æ›´æ–°æ–‡ä»¶æ ‘ä¸­é€‰ä¸­çŠ¶æ€
            const allFileNodes = document.querySelectorAll('.file-tree-node');
            allFileNodes.forEach(n => {
                n.classList.remove('file-tree-node-active');
            });
            
            // è·å–å½“å‰ç‚¹å‡»çš„èŠ‚ç‚¹å…ƒç´ 
            const currentNode = document.querySelector(`.file-tree-node[data-path="${node.path}"]`);
            if (currentNode) {
                currentNode.classList.add('file-tree-node-active');
            }
            
            // æ›´æ–°å½“å‰æ–‡ä»¶åæ˜¾ç¤º
            currentFileNameEl.textContent = node.name;
            
            // æ›´æ–°å½“å‰æ–‡ä»¶è·¯å¾„
            selectedFilePath = node.path;
            
            // å¦‚æœæ˜¯é»˜è®¤æ—¥å¿—ï¼Œç›´æ¥æ˜¾ç¤º
            if (node.name === 'é»˜è®¤ç¤ºä¾‹æ—¥å¿—') {
                logContentEl.innerHTML = `<pre class="whitespace-pre-wrap break-words default-log">${currentFileContent}</pre>`;
                scrollProxyEl.style.width = `${logContentEl.scrollWidth}px`;
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            logContentEl.innerHTML = `
                <div class="text-center text-gray-500 py-16">
                    <i class="fa fa-spinner fa-spin text-4xl mb-3 text-primary"></i>
                    <p>æ­£åœ¨åŠ è½½æ–‡ä»¶å†…å®¹...</p>
                </div>
            `;
            
            // è¯»å–æ–‡ä»¶å†…å®¹
            const reader = new FileReader();
            reader.onload = function(e) {
                currentFileContent = e.target.result;
                node.content = currentFileContent;
                
                // æ˜¾ç¤ºæ–‡ä»¶å†…å®¹
                renderLogContent(node);
                
                // å¦‚æœæœ‰æœç´¢è¯ï¼Œæ‰§è¡Œæœç´¢
                if (searchInputEl.value.trim() !== '') {
                    handleSearch();
                }
            };
            
            reader.readAsText(node.file);
        }
        
        // æ¸²æŸ“æ—¥å¿—å†…å®¹
        function renderLogContent(node) {
            const content = node.content || currentFileContent;
            const lines = content.split('\n');
            
            // åˆ›å»ºè¡Œå®¹å™¨
            const pre = document.createElement('pre');
            pre.className = 'whitespace-pre-wrap break-words';
            
            lines.forEach((line, index) => {
                const lineEl = document.createElement('div');
                lineEl.className = 'log-line';
                lineEl.textContent = line;
                pre.appendChild(lineEl);
            });
            
            logContentEl.innerHTML = '';
            logContentEl.appendChild(pre);
            
            // æ›´æ–°æ»šåŠ¨ä»£ç†å®½åº¦ä»¥åŒ¹é…å†…å®¹å®½åº¦
            scrollProxyEl.style.width = `${logContentEl.scrollWidth}px`;
        }
        
        // å¤„ç†æœç´¢
        function handleSearch() {
            const searchText = searchInputEl.value.trim();
            
            // æ˜¾ç¤ºæˆ–éšè—æ¸…é™¤æŒ‰é’®
            clearSearchEl.style.display = searchText ? 'block' : 'none';
            
            if (!searchText) {
                // æ¸…ç©ºæœç´¢ç»“æœ
                clearSearchHighlight();
                return;
            }
            
            try {
                // éšè—æœç´¢é”™è¯¯
                searchErrorEl.classList.add('hidden');
                
                // è§£æå¤šä¸ªå…³é”®è¯
                let keywords = [];
                
                if (regexCheckbox.checked) {
                    // æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ - æ•´ä¸ªæœç´¢æ–‡æœ¬ä½œä¸ºä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼
                    keywords = [searchText];
                } else {
                    // æ™®é€šæ–‡æœ¬æ¨¡å¼ - ä½¿ç”¨å•å¼•å·åŒ…è£¹å…³é”®å­—å¹¶ç”¨ç©ºæ ¼åˆ†éš”
                    keywords = parseQuotedKeywords(searchText);
                }
                
                if (keywords.length === 0) {
                    clearSearchHighlight();
                    return;
                }
                
                // é‡ç½®å…³é”®è¯é¢œè‰²æ˜ å°„
                keywordColorMap = {};
                keywords.forEach((keyword, index) => {
                    keywordColorMap[keyword] = highlightColors[index % highlightColors.length];
                });
                
                // æ›´æ–°å…³é”®è¯é¢œè‰²å›¾ä¾‹
                updateKeywordLegend(keywords);
                
                // æ‰§è¡Œæœç´¢
                let matches = 0;
                
                // è·å–æ‰€æœ‰æ—¥å¿—è¡Œ
                const logLines = logContentEl.querySelectorAll('.log-line');
                
                // éå†æ‰€æœ‰è¡Œ
                logLines.forEach(lineEl => {
                    let lineText = lineEl.textContent;
                    let lineHasMatch = false;
                    
                    // å¯¹æ¯ä¸ªå…³é”®è¯è¿›è¡ŒåŒ¹é…
                    keywords.forEach(keyword => {
                        let regex;
                        
                        if (regexCheckbox.checked) {
                            // æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼
                            const flags = ignoreCaseCheckbox.checked ? 'gi' : 'g';
                            regex = new RegExp(keyword, flags);
                        } else {
                            // æ™®é€šæ–‡æœ¬æ¨¡å¼ - è½¬ä¹‰æ­£åˆ™ç‰¹æ®Šå­—ç¬¦
                            const escapedKeyword = keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                            const flags = ignoreCaseCheckbox.checked ? 'gi' : 'g';
                            regex = new RegExp(escapedKeyword, flags);
                        }
                        
                        // æ£€æŸ¥è¯¥è¡Œæ˜¯å¦æœ‰åŒ¹é…
                        if (regex.test(lineText)) {
                            lineHasMatch = true;
                            matches++;
                            
                            // é«˜äº®å…³é”®è¯
                            lineText = lineText.replace(regex, match => {
                                return `<span class="${keywordColorMap[keyword]}">${match}</span>`;
                            });
                        }
                    });
                    
                    // æ›´æ–°è¡Œå†…å®¹
                    lineEl.innerHTML = lineText;
                    
                    // æ ¹æ®æ˜¯å¦æ˜¾ç¤ºåŒ¹é…è¡Œé€‰é¡¹å¤„ç†æ˜¾ç¤ºçŠ¶æ€
                    if (showOnlyMatchesCheckbox.checked) {
                        if (lineHasMatch) {
                            lineEl.classList.remove('hidden-line');
                        } else {
                            lineEl.classList.add('hidden-line');
                        }
                    } else {
                        lineEl.classList.remove('hidden-line');
                    }
                });
                
                // æ›´æ–°æ–‡ä»¶æ ‘ä¸­çš„æœç´¢ç»“æœæ ‡è®°
                if (multiFileSearchCheckbox.checked && matches > 0 && selectedFilePath) {
                    updateFileTreeSearchResults(keywords);
                }
                
                // æ˜¾ç¤ºæœç´¢ç»“æœæç¤º
                showToast(`æ‰¾åˆ° ${matches} ä¸ªåŒ¹é…é¡¹`);
            } catch (error) {
                // æ˜¾ç¤ºæœç´¢é”™è¯¯
                searchErrorEl.querySelector('span').textContent = error.message;
                searchErrorEl.classList.remove('hidden');
                console.error('æœç´¢é”™è¯¯:', error);
            }
        }
        
        // è§£æå¸¦å•å¼•å·çš„å…³é”®å­—
        function parseQuotedKeywords(text) {
            // å°è¯•åŒ¹é…å•å¼•å·åŒ…è£¹çš„å…³é”®å­—
            const quotedPattern = /'([^']*)'/g;
            const matches = [];
            let match;
            
            while ((match = quotedPattern.exec(text)) !== null) {
                if (match[1].trim() !== '') {
                    matches.push(match[1]);
                }
            }
            
            // å¦‚æœæ‰¾åˆ°å¸¦å¼•å·çš„å…³é”®å­—ï¼Œè¿”å›å®ƒä»¬
            if (matches.length > 0) {
                return matches;
            }
            
            // å¦‚æœæ²¡æœ‰æ‰¾åˆ°å¸¦å¼•å·çš„å…³é”®å­—ï¼ŒæŒ‰ç©ºæ ¼åˆ†å‰²
            return text.split(/\s+/).filter(word => word.trim() !== '');
        }
        
        // æ›´æ–°å…³é”®è¯é¢œè‰²å›¾ä¾‹
        function updateKeywordLegend(keywords) {
            keywordLegendEl.innerHTML = '<span class="text-xs text-gray-600">å…³é”®è¯é¢œè‰²:</span>';
            
            keywords.forEach(keyword => {
                const colorClass = keywordColorMap[keyword];
                const legendItem = document.createElement('span');
                legendItem.className = `text-xs px-1.5 py-0.5 rounded mx-1 ${colorClass}`;
                legendItem.textContent = keyword;
                keywordLegendEl.appendChild(legendItem);
            });
            
            keywordLegendEl.classList.remove('hidden');
        }
        
        // æ›´æ–°æ–‡ä»¶æ ‘ä¸­çš„æœç´¢ç»“æœæ ‡è®°
        function updateFileTreeSearchResults(keywords) {
            // é‡ç½®æ‰€æœ‰æ–‡ä»¶çš„åŒ¹é…çŠ¶æ€
            resetFileTreeMatchIndicators();
            
            // éå†æ‰€æœ‰æ–‡ä»¶èŠ‚ç‚¹
            const fileNodes = document.querySelectorAll('.file-tree-node');
            fileNodes.forEach(nodeEl => {
                if (!nodeEl.dataset.path) return;
                
                // æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶èŠ‚ç‚¹
                const path = nodeEl.dataset.path;
                const fileNode = findFileByPath(folderStructure, path);
                
                if (fileNode && fileNode.content) {
                    // æ£€æŸ¥æ–‡ä»¶å†…å®¹æ˜¯å¦åŒ…å«ä»»ä½•å…³é”®è¯
                    let hasMatch = false;
                    
                    keywords.forEach(keyword => {
                        let regex;
                        
                        if (regexCheckbox.checked) {
                            const flags = ignoreCaseCheckbox.checked ? 'gi' : 'g';
                            regex = new RegExp(keyword, flags);
                        } else {
                            const escapedKeyword = keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                            const flags = ignoreCaseCheckbox.checked ? 'gi' : 'g';
                            regex = new RegExp(escapedKeyword, flags);
                        }
                        
                        if (regex.test(fileNode.content)) {
                            hasMatch = true;
                        }
                    });
                    
                    // æ›´æ–°æ–‡ä»¶èŠ‚ç‚¹çš„åŒ¹é…çŠ¶æ€
                    if (hasMatch) {
                        fileNode.hasMatches = true;
                        const flexElement = nodeEl.querySelector('.flex');
                        if (flexElement) {
                            // æ£€æŸ¥æ˜¯å¦å·²æœ‰æç¤º
                            if (!flexElement.querySelector('.search-match-indicator')) {
                                const indicator = document.createElement('span');
                                indicator.className = 'ml-2 text-xs text-primary bg-primary/10 px-1 rounded search-match-indicator';
                                indicator.textContent = 'æœ‰åŒ¹é…';
                                flexElement.appendChild(indicator);
                            }
                        }
                    }
                }
            });
        }
        
        // é‡ç½®æ–‡ä»¶æ ‘åŒ¹é…æ ‡è®°
        function resetFileTreeMatchIndicators() {
            // éå†æ‰€æœ‰æ–‡ä»¶èŠ‚ç‚¹
            const fileNodes = document.querySelectorAll('.file-tree-node');
            fileNodes.forEach(nodeEl => {
                if (!nodeEl.dataset.path) return;
                
                // æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶èŠ‚ç‚¹
                const path = nodeEl.dataset.path;
                const fileNode = findFileByPath(folderStructure, path);
                
                if (fileNode) {
                    fileNode.hasMatches = false;
                }
                
                // ç§»é™¤åŒ¹é…æç¤º
                const indicator = nodeEl.querySelector('.search-match-indicator');
                if (indicator) {
                    indicator.remove();
                }
            });
        }
        
        // æ ¹æ®è·¯å¾„æŸ¥æ‰¾æ–‡ä»¶èŠ‚ç‚¹
        function findFileByPath(node, path) {
            if (node.path === path) {
                return node;
            }
            
            if (node.children && node.children.length > 0) {
                for (const child of node.children) {
                    const found = findFileByPath(child, path);
                    if (found) return found;
                }
            }
            
            return null;
        }
        
        // æ¸…é™¤æœç´¢é«˜äº®
        function clearSearchHighlight() {
            if (!currentFileContent) return;
            
            // è·å–æ‰€æœ‰æ—¥å¿—è¡Œ
            const logLines = logContentEl.querySelectorAll('.log-line');
            
            // ç§»é™¤æ‰€æœ‰é«˜äº®å¹¶æ˜¾ç¤ºæ‰€æœ‰è¡Œ
            logLines.forEach(lineEl => {
                lineEl.classList.remove('hidden-line');
                
                // ç§»é™¤é«˜äº®spanï¼Œä¿ç•™æ–‡æœ¬å†…å®¹
                if (lineEl.innerHTML !== lineEl.textContent) {
                    lineEl.textContent = lineEl.textContent;
                }
            });
            
            // æ›´æ–°æ»šåŠ¨ä»£ç†å®½åº¦ä»¥åŒ¹é…å†…å®¹å®½åº¦
            scrollProxyEl.style.width = `${logContentEl.scrollWidth}px`;
            
            // éšè—å…³é”®è¯å›¾ä¾‹
            keywordLegendEl.classList.add('hidden');
            
            // é‡ç½®æ–‡ä»¶æ ‘åŒ¹é…æ ‡è®°
            resetFileTreeMatchIndicators();
        }
        
        // æ¸…é™¤é«˜äº®
        function clearHighlight() {
            clearSearchHighlight();
            
            // æ˜¾ç¤ºæç¤º
            showToast('å·²æ¸…é™¤æ‰€æœ‰é«˜äº®');
        }
        
        // æ¸…é™¤æœç´¢
        function clearSearch() {
            searchInputEl.value = '';
            clearSearchEl.style.display = 'none';
            clearSearchHighlight();
            searchErrorEl.classList.add('hidden');
            
            searchInputEl.focus();
        }
        
        // å¤åˆ¶æ—¥å¿—
        function copyLogs() {
            if (!currentFileContent) {
                showToast('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹');
                return;
            }
            
            navigator.clipboard.writeText(currentFileContent)
                .then(() => {
                    showToast('æ—¥å¿—å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                })
                .catch(err => {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
                });
        }
        
        // è®¾ç½®å¯è°ƒæ•´å¤§å°
        function setupResizer() {
            let isResizing = false;
            
            resizer.addEventListener('mousedown', (e) => {
                isResizing = true;
                document.body.style.cursor = 'col-resize';
            });
            
            document.addEventListener('mousemove', (e) => {
                if (!isResizing) return;
                
                const containerWidth = document.body.clientWidth;
                const newFileTreeWidth = e.clientX - 20; // å‡å»è¾¹è·
                
                // é™åˆ¶æœ€å°å®½åº¦
                if (newFileTreeWidth > 150 && newFileTreeWidth < containerWidth - 200) {
                    fileTreeContainer.style.width = `${newFileTreeWidth}px`;
                    logContainer.style.width = `calc(100% - ${newFileTreeWidth + 20}px)`;
                }
            });
            
            document.addEventListener('mouseup', () => {
                isResizing = false;
                document.body.style.cursor = '';
            });
        }
        
        // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showToast(message, type = 'info') {
            // ç§»é™¤ç°æœ‰çš„æç¤º
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            // åˆ›å»ºæ–°æç¤º
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            
            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(toast);
            
            // æ˜¾ç¤ºåŠ¨ç”»
            setTimeout(() => {
                toast.classList.remove('scale-95', 'opacity-0');
                toast.classList.add('scale-100', 'opacity-100');
            }, 10);
            
            // è‡ªåŠ¨éšè—
            setTimeout(() => {
                toast.classList.remove('scale-100', 'opacity-100');
                toast.classList.add('scale-95', 'opacity-0');
                
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 3000);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>

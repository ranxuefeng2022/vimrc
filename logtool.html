<!DOCTYPE html>
<html lang="en">
<head>
	<style>
	/* éšè—æ°´å¹³æ»šåŠ¨æ¡ */
	body {
		overflow-x: hidden;
	}

	/* éšè—å‚ç›´æ»šåŠ¨æ¡ */
	body {
		overflow-y: hidden;
	}
	</style>

	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>é«˜çº§æ—¥å¿—åˆ†æå·¥å…· - å…³é”®è¯é¢œè‰²é«˜äº®</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">

	<script>
		tailwind.config = {
			theme: {
				extend: {
					colors: {
						primary: '#165DFF',
						secondary: '#0e42c7',
						neutral: '#86909C',
						dark: '#1d2129'
					},
					fontFamily: {
						mono: ['Consolas', 'Monaco', 'monospace']
					}
				}
			}
		}
	</script>

	<style type="text/tailwindcss">
		@layer utilities {
			.log-container {
				height: calc(100vh - 185px); /* å¢åŠ é«˜åº¦é€‚åº”æ–°UI */
				overflow-y: auto;
			}
			.horizontal-scrollbar {
				position: sticky;
				bottom: 0;
				z-index: 10;
				background-color: white;
				border-top: 1px solid #eee;
			}
			.sync-scroll {
				scrollbar-width: thin;
			}
			.key-hint {
				@apply inline-block bg-gray-100 text-gray-700 text-xs px-1.5 py-0.5 rounded mx-0.5;
			}
			/* é«˜äº®é¢œè‰²å®šä¹‰ */
			.highlight-0 { @apply bg-yellow-200 text-gray-800; }
			.highlight-1 { @apply bg-blue-200 text-gray-800; }
			.highlight-2 { @apply bg-green-200 text-gray-800; }
			.highlight-3 { @apply bg-pink-200 text-gray-800; }
			.highlight-4 { @apply bg-purple-200 text-gray-800; }
			.highlight-5 { @apply bg-orange-200 text-gray-800; }
			.highlight-6 { @apply bg-cyan-200 text-gray-800; }
			.highlight-7 { @apply bg-red-200 text-gray-800; }
			.highlight-8 { @apply bg-lime-200 text-gray-800; }
			.highlight-9 { @apply bg-amber-200 text-gray-800; }
		}
	</style>
</head>
<body class="bg-gray-50 m-0 p-0 font-sans">
	<!-- é¡¶éƒ¨å¯¼èˆª -->
	<header class="bg-gradient-to-r from-primary to-secondary shadow-xs p-3">
		<div class="flex justify-between items-center">
			<div class="flex items-center">
				<i class="fa fa-file-text-o text-white mr-2 text-xl"></i>
				<h1 class="text-xl font-bold text-white inline-block">é«˜çº§ç”µæºæ—¥å¿—åˆ†æå·¥å…·(å¦‚é‡åˆ°é—®é¢˜æ‰¾å†‰é›ªå³° 11143232)</h1>
				<a href="//172.16.191.214/moduleParser/powerLparser/tools/PowerCenter.html" 
					target="_blank"
					rel="noopener noreferrer"
					class="ml-4 bg-yellow-400 hover:bg-yellow-500 text-black font-bold py-1 px-3 rounded-lg shadow-md hover:shadow-lg transition-all duration-200">
					ğŸ”¥ çŒ›æˆ³è¿™é‡Œè·å¾—æ›´å¤šä¿¡æ¯ ğŸ”¥
				</a>
			</div>
			<div class="flex gap-2">
				<button id="uploadBtn" class="bg-white text-primary px-4 py-2 rounded-lg text-sm flex items-center font-medium hover:bg-gray-50 transition">
					<i class="fa fa-upload mr-2"></i>å¯¼å…¥æ—¥å¿—
				</button>
				<button id="copyBtn" class="bg-white text-gray-700 px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-50 transition flex items-center">
					<i class="fa fa-copy mr-2"></i>å¤åˆ¶
				</button>
			</div>
		</div>
	</header>

	<!-- æœç´¢å’Œå¿«æ·é”®æç¤ºåŒºåŸŸ -->
	<div class="bg-white border-b border-gray-100 p-4">
		<div class="flex flex-wrap items-center gap-4">
			<!-- æœç´¢æ¡†åŒºåŸŸï¼ˆä¿æŒä¸å˜ï¼‰ -->
			<div class="relative flex-1 min-w-[300px] max-w-3xl">
				<div class="flex items-center gap-2 mb-2">
					<i class="fa fa-search text-neutral"></i>
					<input type="text" id="searchInput" placeholder="æœç´¢æ—¥å¿—å†…å®¹ï¼ˆæ”¯æŒç©ºæ ¼åˆ†éš”å¤šå…³é”®è¯ï¼‰..."
						   class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-base">
					<button id="clearSearch" class="text-neutral hover:text-gray-700 transition hidden">
						<i class="fa fa-times-circle text-lg"></i>
					</button>
				</div>

				<!-- å…³é”®è¯é¢œè‰²å›¾ä¾‹ -->
				<div id="keywordLegend" class="flex flex-wrap gap-2 mt-2 hidden">
					<span class="text-xs text-gray-600">å…³é”®è¯é¢œè‰²:</span>
				</div>
			</div>

			<!-- ä¿®æ”¹åçš„é€‰é¡¹å’Œå¿«æ·é”®åŒºåŸŸ -->
			<div class="flex items-start gap-4">
				<!-- é€‰é¡¹åŒºåŸŸ - æ”¹ä¸ºæ°´å¹³æ’åˆ— -->
				<div class="flex gap-4 text-sm bg-gray-50 p-3 rounded-lg border border-gray-200 border-[0.5px]">
					<label class="flex items-center text-gray-700 cursor-pointer whitespace-nowrap">
						<input type="checkbox" id="regexCheckbox" class="mr-2 h-4 w-4 text-primary rounded focus:ring-primary">
						æ­£åˆ™è¡¨è¾¾å¼
					</label>
					<label class="flex items-center text-gray-700 cursor-pointer whitespace-nowrap">
						<input type="checkbox" id="ignoreCaseCheckbox" class="mr-2 h-4 w-4 text-primary rounded focus:ring-primary" checked>
						å¿½ç•¥å¤§å°å†™
					</label>
					<div id="searchError" class="flex items-center text-red-500 text-sm hidden ml-2">
						<i class="fa fa-exclamation-triangle mr-1"></i><span></span>
					</div>
				</div>

				<!-- å¿«æ·é”®æç¤ºåŒºåŸŸ -->
				<div class="text-sm bg-gray-50 p-3 rounded-lg border border-gray-200 border-[0.5px]">
					<div class="flex flex-wrap gap-2 text-xs">
						<div class="flex items-center">
							<span class="key-hint">â†</span>
							<span class="text-gray-600 ml-1">å‘å·¦æ»šåŠ¨</span>
						</div>
						<div class="flex items-center">
							<span class="key-hint">â†’</span>
							<span class="text-gray-600 ml-1">å‘å³æ»šåŠ¨</span>
						</div>
						<div class="flex items-center">
							<span class="key-hint">Shift+â†</span>
							<span class="text-gray-600 ml-1">å¿«é€Ÿå·¦æ»š</span>
						</div>
						<div class="flex items-center">
							<span class="key-hint">Shift+â†’</span>
							<span class="text-gray-600 ml-1">å¿«é€Ÿå³æ»š</span>
						</div>
						<div class="flex items-center">
							<span class="key-hint">F/f</span>
							<span class="text-gray-600 ml-1">èšç„¦æœç´¢æ¡†</span>
						</div>
						<div class="flex items-center">
							<span class="key-hint">Esc</span>
							<span class="text-gray-600 ml-1">æ¸…é™¤æœç´¢</span>
						</div>
						<div class="flex items-center">
							<span class="key-hint">Alt+x</span>
							<span class="text-gray-600 ml-1">å…¨å±</span>
						</div>
					</div>
				</div>
			</div>

			<!-- è®¡æ•°åŒºåŸŸ -->
			<div class="ml-auto text-sm text-gray-700 bg-gray-50 px-3 py-2 rounded-lg border border-gray-200 border-[0.5px]">
				<div class="flex items-center">
					<span id="matchCount" class="font-medium">0 æ¡åŒ¹é…</span>
					<span class="mx-2 text-gray-400">|</span>
					<span id="totalCount" class="font-medium">å…± 0 æ¡</span>
				</div>
			</div>
		</div>
	</div>

	<!-- æ—¥å¿—å†…å®¹åŒºåŸŸ -->
	<div class="p-4">
		<!-- æ—¥å¿—æ˜¾ç¤ºå®¹å™¨ -->
		<div class="border border-gray-200 border-t-0 rounded-b-lg bg-white shadow-sm">
			<!-- æ—¥å¿—æ–‡æœ¬åŒºåŸŸ - çºµå‘æ»šåŠ¨ -->
			<div id="logContent" class="log-container font-mono text-sm">
				<div id="logLines" class="divide-y divide-gray-100">
					<!-- æ—¥å¿—å†…å®¹å°†é€šè¿‡JSå¡«å…… -->
				</div>
			</div>

			<!-- æ¨ªå‘æ»šåŠ¨æ¡ - å›ºå®šåœ¨åº•éƒ¨ï¼Œä¸å†…å®¹åŒæ­¥æ»šåŠ¨ -->
			<div class="horizontal-scrollbar">
				<div id="syncScroll" class="sync-scroll h-3">
					<div id="scrollProxy" class="h-3"></div>
				</div>
			</div>
		</div>
	</div>

	<script>
		//LOGENGIN_INIT_DATA

		// DOMå…ƒç´ 
		const logLinesEl = document.getElementById('logLines');
		const logContentEl = document.getElementById('logContent');
		const syncScrollEl = document.getElementById('syncScroll');
		const scrollProxyEl = document.getElementById('scrollProxy');
		const searchInputEl = document.getElementById('searchInput');
		const clearSearchEl = document.getElementById('clearSearch');
		const matchCountEl = document.getElementById('matchCount');
		const totalCountEl = document.getElementById('totalCount');
		const uploadBtnEl = document.getElementById('uploadBtn');
		const copyBtnEl = document.getElementById('copyBtn');
		const regexCheckbox = document.getElementById('regexCheckbox');
		const ignoreCaseCheckbox = document.getElementById('ignoreCaseCheckbox');
		const searchErrorEl = document.getElementById('searchError');
		const keywordLegendEl = document.getElementById('keywordLegend');

		// æ»šåŠ¨é…ç½®
		const SCROLL_SPEED = 50;	   // æ™®é€šæ»šåŠ¨é€Ÿåº¦
		const FAST_SCROLL_SPEED = 200; // å¿«é€Ÿæ»šåŠ¨é€Ÿåº¦ï¼ˆShift+æ–¹å‘é”®ï¼‰

		// å½“å‰æ—¥å¿—æ•°æ®
		let currentLogs = [...logData];
		// é«˜äº®é¢œè‰²æ± 
		const highlightColors = [
			'highlight-0', // é»„è‰²
			'highlight-1', // è“è‰²
			'highlight-2', // ç»¿è‰²
			'highlight-3', // ç²‰è‰²
			'highlight-4', // ç´«è‰²
			'highlight-5', // æ©™è‰²
			'highlight-6', // é’è‰²
			'highlight-7', // çº¢è‰²
			'highlight-8', // é’æŸ è‰²
			'highlight-9'  // ç¥ç€è‰²
		];
		// å…³é”®è¯åˆ°é¢œè‰²çš„æ˜ å°„
		let keywordColorMap = {};

		// åˆå§‹åŒ–
		function init() {
			renderLogs(currentLogs);
			setupScrollSync();
			setupEventListeners();
			setupKeyboardNavigation();
			updateCounters(currentLogs.length, 0);
			initEventListeners();
		}

		// å…¨å±åˆ‡æ¢å‡½æ•°
		function toggleFullscreen() {
			if (!document.fullscreenElement) {
				// è¿›å…¥å…¨å±
				if (document.documentElement.requestFullscreen) {
					document.documentElement.requestFullscreen();
				} else if (document.documentElement.webkitRequestFullscreen) {
					document.documentElement.webkitRequestFullscreen();
				} else if (document.documentElement.msRequestFullscreen) {
					document.documentElement.msRequestFullscreen();
				}
				showToast('é€€å‡ºå…¨å±ç»§ç»­æŒ‰Alt+x');
			} else {
				// é€€å‡ºå…¨å±
				if (document.exitFullscreen) {
					document.exitFullscreen();
				} else if (document.webkitExitFullscreen) {
					document.webkitExitFullscreen();
				} else if (document.msExitFullscreen) {
					document.msExitFullscreen();
				}
			}
		}

		// å¤„ç†å…¨å±å˜åŒ–
		function handleFullscreenChange() {
			if (document.fullscreenElement) {
				fullscreenInfo.style.display = 'block';
			} else {
				fullscreenInfo.style.display = 'none';
			}
		}

		// è®¾ç½®å¿«æ·é”®ç›‘å¬
		function setupShortcutListener() {
			document.addEventListener('keydown', (e) => {
				// æ£€æµ‹ Alt + X
				if (e.altKey && (e.key === 'x' || e.key === 'X')) {
					toggleFullscreen();
					e.preventDefault();
				}
			});
		}

		// åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
		function initEventListeners() {
			// å…¨å±äº‹ä»¶ç›‘å¬
			document.addEventListener('fullscreenchange', handleFullscreenChange);
			document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
			document.addEventListener('msfullscreenchange', handleFullscreenChange);

			// è®¾ç½®å¿«æ·é”®
			setupShortcutListener();
		}

		// æ¸²æŸ“æ—¥å¿—
		function renderLogs(logs) {
			logLinesEl.innerHTML = '';

			logs.forEach((log, index) => {
				const lineEl = document.createElement('div');
				lineEl.className = 'flex py-2 px-4 hover:bg-gray-50 transition-colors';

				// è¡Œå·
				const lineNum = document.createElement('span');
				lineNum.className = 'text-neutral w-10 text-right pr-3 border-r border-gray-100 mr-3 select-none';
				lineNum.textContent = index + 1;

				// æ—¥å¿—æ–‡æœ¬
				const logText = document.createElement('span');
				logText.className = 'whitespace-nowrap';
				logText.textContent = log;

				lineEl.appendChild(lineNum);
				lineEl.appendChild(logText);
				logLinesEl.appendChild(lineEl);
			});

			// æ›´æ–°æ»šåŠ¨ä»£ç†å®½åº¦ä»¥åŒ¹é…å†…å®¹å®½åº¦
			scrollProxyEl.style.width = `${logLinesEl.scrollWidth}px`;
		}

		// è®¾ç½®æ»šåŠ¨åŒæ­¥ - æ¨ªå‘æ»šåŠ¨æ¡ä¸å†…å®¹åŒæ­¥
		function setupScrollSync() {
			// å½“å†…å®¹æ¨ªå‘æ»šåŠ¨æ—¶ï¼ŒåŒæ­¥æ»šåŠ¨æ¡ä½ç½®
			logContentEl.addEventListener('scroll', (e) => {
				syncScrollEl.scrollLeft = e.target.scrollLeft;
			});

			// å½“æ»šåŠ¨æ¡æ»šåŠ¨æ—¶ï¼ŒåŒæ­¥å†…å®¹ä½ç½®
			syncScrollEl.addEventListener('scroll', (e) => {
				logContentEl.scrollLeft = e.target.scrollLeft;
			});
		}

		// è®¾ç½®é”®ç›˜å¯¼èˆª - å·¦å³æ–¹å‘é”®æ§åˆ¶æ¨ªå‘æ»šåŠ¨
		function setupKeyboardNavigation() {
			document.addEventListener('keydown', (e) => {
				// å¦‚æœæœç´¢æ¡†èšç„¦ï¼Œåˆ™ä¸å¤„ç†æ»šåŠ¨ï¼ˆé¿å…å½±å“è¾“å…¥ï¼‰
				if (document.activeElement === searchInputEl) {
					// æ”¯æŒEscæ¸…é™¤æœç´¢
					if (e.key === 'Escape') {
						clearSearch();
					}
					return;
				}

				// Fé”®èšç„¦æœç´¢æ¡†
				if (e.key === 'f' || e.key === 'F') {
					// æ£€æŸ¥æ˜¯å¦æŒ‰ä¸‹äº†Ctrlé”®
					if (e.ctrlKey || e.metaKey) {
						// å¦‚æœæ˜¯Ctrl+Fï¼Œåˆ™å…è®¸æµè§ˆå™¨é»˜è®¤è¡Œä¸º
						return;
					}
					e.preventDefault();
					searchInputEl.focus();
					searchInputEl.select();
					searchBoxEl.classList.add('focused');
					showToast('å·²èšç„¦æœç´¢æ¡† - æŒ‰Enteræœç´¢');
					return;
				}

				// æ”¯æŒEscæ¸…é™¤æœç´¢
				if (e.key === 'Escape') {
					clearSearch();
					return;
				}

				const isShiftPressed = e.shiftKey;
				const scrollAmount = isShiftPressed ? FAST_SCROLL_SPEED : SCROLL_SPEED;

				// å·¦æ–¹å‘é”® - å‘å·¦æ»šåŠ¨
				if (e.key === 'ArrowLeft') {
					e.preventDefault(); // é˜»æ­¢é¡µé¢é»˜è®¤æ»šåŠ¨è¡Œä¸º
					const newScrollLeft = logContentEl.scrollLeft - scrollAmount;
					logContentEl.scrollLeft = Math.max(0, newScrollLeft);
				}

				// å³æ–¹å‘é”® - å‘å³æ»šåŠ¨
				if (e.key === 'ArrowRight') {
					e.preventDefault(); // é˜»æ­¢é¡µé¢é»˜è®¤æ»šåŠ¨è¡Œä¸º
					const maxScroll = logLinesEl.scrollWidth - logContentEl.clientWidth;
					const newScrollLeft = logContentEl.scrollLeft + scrollAmount;
					logContentEl.scrollLeft = Math.min(maxScroll, newScrollLeft);
				}
			});
		}

		// è®¾ç½®äº‹ä»¶ç›‘å¬
		function setupEventListeners() {

			// æ·»åŠ  Enter é”®äº‹ä»¶ç›‘å¬
			searchInputEl.addEventListener('keydown', function(e) {
				if (e.key === 'Enter' || e.keyCode === 13) {
					handleSearch(); // ä»…åœ¨æŒ‰ä¸‹ Enter æ—¶è§¦å‘æœç´¢
				}
			});

			clearSearchEl.addEventListener('click', clearSearch);

			// æ­£åˆ™å’Œå¿½ç•¥å¤§å°å†™è®¾ç½®æ”¹å˜æ—¶é‡æ–°æœç´¢
			regexCheckbox.addEventListener('change', handleSearch);
			ignoreCaseCheckbox.addEventListener('change', handleSearch);

			// ä¸Šä¼ æ—¥å¿—
			uploadBtnEl.addEventListener('click', () => {
				const fileInput = document.createElement('input');
				fileInput.type = 'file';

				fileInput.setAttribute('data-allow-no-extension', 'true');
				fileInput.onchange = handleFileUpload;
				fileInput.click();
			});

			// å¤åˆ¶æ—¥å¿—
			copyBtnEl.addEventListener('click', copyLogs);
		}

		// å¤„ç†æœç´¢
		function handleSearch() {
			const searchTerm = searchInputEl.value.trim();
			const isRegex = regexCheckbox.checked;
			const ignoreCase = ignoreCaseCheckbox.checked;

			// æ¸…é™¤ä¹‹å‰çš„é”™è¯¯æç¤º
			searchErrorEl.classList.add('hidden');
			searchInputEl.classList.remove('border-red-500');

			// æ˜¾ç¤º/éšè—æ¸…é™¤æŒ‰é’®
			clearSearchEl.style.display = searchTerm ? 'block' : 'none';

			if (!searchTerm) {
				// æ— æœç´¢è¯ï¼Œæ˜¾ç¤ºæ‰€æœ‰æ—¥å¿—
				renderLogs(currentLogs);
				updateCounters(currentLogs.length, 0);
				keywordLegendEl.classList.add('hidden');
				return;
			}

			try {
				// é‡ç½®å…³é”®è¯é¢œè‰²æ˜ å°„
				keywordColorMap = {};

				// è¿‡æ»¤æ—¥å¿—
				let filteredLogs;
				if (isRegex) {
					// æ­£åˆ™æ¨¡å¼ - æ•´ä¸ªæ­£åˆ™ä½œä¸ºä¸€ä¸ª"å…³é”®è¯"
					const regex = new RegExp(searchTerm, ignoreCase ? 'gi' : 'g');
					filteredLogs = currentLogs.filter(log => regex.test(log));

					// ä¸ºæ•´ä¸ªæ­£åˆ™åˆ†é…ä¸€ä¸ªé¢œè‰²
					keywordColorMap[searchTerm] = highlightColors[0];
					updateKeywordLegend();
				} else {
					// æ™®é€šæ¨¡å¼ - æ”¯æŒå¤šä¸ªå…³é”®è¯ï¼ˆç©ºæ ¼åˆ†éš”ï¼‰
					const keywords = searchTerm.split(/\s+/).filter(k => k.length > 0);

					if (keywords.length === 0) {
						filteredLogs = currentLogs;
					} else {
						// ä¸ºæ¯ä¸ªå…³é”®è¯åˆ†é…é¢œè‰²
						keywords.forEach((keyword, index) => {
							const normalizedKeyword = ignoreCase ? keyword.toLowerCase() : keyword;
							keywordColorMap[normalizedKeyword] = highlightColors[index % highlightColors.length];
						});

						updateKeywordLegend();

						// åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ‰€æœ‰å…³é”®è¯
						const regex = new RegExp(
							keywords.map(k => escapeRegExp(k)).join('|'),
							ignoreCase ? 'gi' : 'g'
						);

						filteredLogs = currentLogs.filter(log => regex.test(log));
					}
				}

				renderLogs(filteredLogs);
				updateCounters(currentLogs.length, filteredLogs.length);
				highlightMatches(searchTerm, isRegex, ignoreCase);
			} catch (e) {
				// å¤„ç†æ­£åˆ™è¡¨è¾¾å¼é”™è¯¯
				searchErrorEl.querySelector('span').textContent = e.message;
				searchErrorEl.classList.remove('hidden');
				searchInputEl.classList.add('border-red-500');
				keywordLegendEl.classList.add('hidden');
			}
		}

		// æ›´æ–°å…³é”®è¯é¢œè‰²å›¾ä¾‹
		function updateKeywordLegend() {
			keywordLegendEl.innerHTML = '<span class="text-xs text-gray-600">å…³é”®è¯é¢œè‰²:</span>';

			Object.entries(keywordColorMap).forEach(([keyword, colorClass]) => {
				const legendItem = document.createElement('div');
				legendItem.className = `flex items-center text-xs ml-2`;

				const colorBox = document.createElement('span');
				colorBox.className = `inline-block w-3 h-3 rounded-full mr-1 ${colorClass}`;

				const keywordText = document.createElement('span');
				keywordText.className = 'text-gray-700';
				keywordText.textContent = keyword.length > 10 ? `${keyword.substring(0, 8)}...` : keyword;

				legendItem.appendChild(colorBox);
				legendItem.appendChild(keywordText);
				keywordLegendEl.appendChild(legendItem);
			});

			keywordLegendEl.classList.remove('hidden');
		}

		// æ¸…é™¤æœç´¢
		function clearSearch() {
			searchInputEl.value = '';
			clearSearchEl.style.display = 'none';
			searchErrorEl.classList.add('hidden');
			searchInputEl.classList.remove('border-red-500');
			keywordLegendEl.classList.add('hidden');
			renderLogs(currentLogs);
			updateCounters(currentLogs.length, 0);
		}

		// é«˜äº®åŒ¹é…å†…å®¹ï¼ˆç¡®ä¿ç›¸åŒå…³é”®è¯ä½¿ç”¨ç›¸åŒé¢œè‰²ï¼‰
		function highlightMatches(term, isRegex, ignoreCase) {
			const logTexts = logLinesEl.querySelectorAll('span:last-child');

			logTexts.forEach(textEl => {
				const text = textEl.textContent;
				let html = '';
				let lastIndex = 0;
				let match;

				try {
					if (isRegex) {
						// æ­£åˆ™æ¨¡å¼ - æ•´ä¸ªæ­£åˆ™ä½œä¸ºä¸€ä¸ª"å…³é”®è¯"
						const regex = new RegExp(term, ignoreCase ? 'gi' : 'g');
						const colorClass = keywordColorMap[term];

						while ((match = regex.exec(text)) !== null) {
							// åŒ¹é…ä¹‹å‰çš„æ–‡æœ¬
							const before = text.substring(lastIndex, match.index);
							// åŒ¹é…çš„æ–‡æœ¬
							const matchedText = match[0];

							// æ·»åŠ åˆ°HTML
							html += before + `<span class="${colorClass} px-0.5 rounded">${matchedText}</span>`;

							// æ›´æ–°æœ€åç´¢å¼•
							lastIndex = match.index + matchedText.length;

							// é¿å…é›¶é•¿åº¦åŒ¹é…å¯¼è‡´æ— é™å¾ªç¯
							if (match.index === regex.lastIndex) {
								regex.lastIndex++;
							}
						}
					} else {
						// æ™®é€šæ¨¡å¼ - æ”¯æŒå¤šä¸ªå…³é”®è¯
						const keywords = term.split(/\s+/).filter(k => k.length > 0);

						if (keywords.length > 0) {
							// åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ‰€æœ‰å…³é”®è¯
							const regex = new RegExp(
								keywords.map(k => escapeRegExp(k)).join('|'),
								ignoreCase ? 'gi' : 'g'
							);

							while ((match = regex.exec(text)) !== null) {
								// åŒ¹é…ä¹‹å‰çš„æ–‡æœ¬
								const before = text.substring(lastIndex, match.index);
								// åŒ¹é…çš„æ–‡æœ¬
								const matchedText = match[0];
								// è·å–å…³é”®è¯å¯¹åº”çš„é¢œè‰²
								const keyword = ignoreCase ? matchedText.toLowerCase() : matchedText;
								const colorClass = Object.entries(keywordColorMap).find(
									([k]) => ignoreCase
										? keyword.includes(k.toLowerCase())
										: keyword.includes(k)
								)?.[1] || highlightColors[0];

								// æ·»åŠ åˆ°HTML
								html += before + `<span class="${colorClass} px-0.5 rounded">${matchedText}</span>`;

								// æ›´æ–°æœ€åç´¢å¼•
								lastIndex = match.index + matchedText.length;

								// é¿å…é›¶é•¿åº¦åŒ¹é…å¯¼è‡´æ— é™å¾ªç¯
								if (match.index === regex.lastIndex) {
									regex.lastIndex++;
								}
							}
						}
					}

					// æ·»åŠ å‰©ä½™æ–‡æœ¬
					html += text.substring(lastIndex);
					textEl.innerHTML = html;
				} catch (e) {
					// å‡ºé”™æ—¶æ¢å¤åŸå§‹æ–‡æœ¬
					textEl.textContent = text;
				}
			});
		}

		// è½¬ä¹‰æ­£åˆ™è¡¨è¾¾å¼ç‰¹æ®Šå­—ç¬¦
		function escapeRegExp(string) {
			return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
		}

		// æ›´æ–°è®¡æ•°å™¨
		function updateCounters(total, matches) {
			totalCountEl.textContent = `å…± ${total} æ¡`;
			matchCountEl.textContent = `${matches} æ¡åŒ¹é…`;
		}

		// å¤„ç†æ–‡ä»¶ä¸Šä¼ 
		function handleFileUpload(e) {
			const file = e.target.files[0];
			if (!file) return;

			const reader = new FileReader();
			reader.onload = (event) => {
				const content = event.target.result;
				currentLogs = content.split('\n').filter(line => line.trim());
				renderLogs(currentLogs);
				clearSearch();
				updateCounters(currentLogs.length, 0);
			};
			reader.readAsText(file);
		}

		// å¤åˆ¶æ—¥å¿—
		function copyLogs() {
			const textToCopy = currentLogs.join('\n');
			navigator.clipboard.writeText(textToCopy)
				.then(() => {
					showToast('æ—¥å¿—å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
				})
				.catch(() => {
					showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
				});
		}

		// æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
		/**
		 * æ˜¾ç¤ºè½»é‡çº§æç¤ºæ¶ˆæ¯
		 * @param {string} message - æç¤ºå†…å®¹
		 * @param {object} options - é…ç½®é€‰é¡¹
		 * @param {string} options.type - æç¤ºç±»å‹: 'success' | 'error' | 'warning' | 'info'
		 * @param {number} options.duration - æ˜¾ç¤ºæ—¶é•¿(æ¯«ç§’)
		 */
		function showToast(message, options = {}) {
			// åˆå¹¶é»˜è®¤é…ç½®
			const config = {
				type: 'success',
				duration: 900,
				...options
			};

			// åˆ›å»ºæç¤ºå®¹å™¨
			const toast = document.createElement('div');

			// è®¾ç½®åŸºç¡€æ ·å¼
			toast.className = `fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 px-5 py-3 rounded-lg shadow-lg text-sm font-medium transition-all duration-300 transform scale-95 opacity-0 z-50 whitespace-nowrap`;

			// è®¾ç½®æç¤ºç±»å‹æ ·å¼
			const typeStyles = {
				success: 'bg-green-50 text-green-700 border border-green-200',
				error: 'bg-red-50 text-red-700 border border-red-200',
				warning: 'bg-yellow-50 text-yellow-700 border border-yellow-200',
				info: 'bg-blue-50 text-blue-700 border border-blue-200'
			};
			toast.classList.add(...typeStyles[config.type].split(' '));

			// è®¾ç½®å›¾æ ‡
			const icons = {
				success: 'fa-check-circle',
				error: 'fa-exclamation-circle',
				warning: 'fa-exclamation-triangle',
				info: 'fa-info-circle'
			};

			// æ„å»ºæç¤ºå†…å®¹
			toast.innerHTML = `
				<div class="flex items-center">
					<i class="fa ${icons[config.type]} mr-2"></i>
					<span>${message}</span>
				</div>
			`;

			// æ·»åŠ åˆ°DOM
			document.body.appendChild(toast);

			// æ˜¾ç¤ºåŠ¨ç”»
			setTimeout(() => {
				toast.classList.remove('scale-95', 'opacity-0');
				toast.classList.add('scale-100', 'opacity-100');
			}, 10);

			// éšè—åŠ¨ç”»
			setTimeout(() => {
				toast.classList.remove('scale-100', 'opacity-100');
				toast.classList.add('scale-95', 'opacity-0');

				setTimeout(() => {
					document.body.removeChild(toast);
				}, 300);
			}, config.duration);

			return {
				dismiss: () => {
					// ç«‹å³éšè—æç¤º
					if (document.body.contains(toast)) {
						toast.remove();
					}
				}
			};
		}

		// æ·»åŠ å…¨å±€æ ·å¼
		(function addGlobalStyles() {
			const style = document.createElement('style');
			style.textContent = `
				/* ç¡®ä¿Font AwesomeåŠ è½½ */
				@import url('https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css');
			`;
			document.head.appendChild(style);
		})();

		// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
		document.addEventListener('DOMContentLoaded', init);
	</script>
</body>
</html>
